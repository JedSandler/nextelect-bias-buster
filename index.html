<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>NextElect ‚Äî Issue of the Week (Multi-Issue)</title>
  <style>
    /* ===== Theme / Base ===== */
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%}
    :root{
      --bg:#3c3f46;
      --fg:#f2f2f2;
      --muted:#d5d5d5;
      --tile:#f7f7f7;
      --tile-border:#dcdcdc;
      --green-bg:#d4edda;
      --green-fg:#155724;
      --red-bg:#f8d7da;
      --red-fg:#721c24;
      --accent:#e6e6e6;
      --card:#2b2f36;
      --card-border:#3a3e47;
      --link-modal:#cfe2ff; /* lighter (Sources & Links modal / final) */
      --link-bias:#aecdff;  /* slightly darker (Bias Buster only) */
    }
    body{
      font-family: Verdana, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--fg);
      min-height:100vh;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .hidden{display:none!important}

    .center{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:12px;
      overflow:hidden;
    }

    .screen{
      width:100%;
      max-width:1020px;
      margin:0 auto;
      max-height:100%;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    /* Branding row */
    .brand{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:.8rem;
      margin:0 0 12px;
      flex-shrink:0;
      text-align:center;
    }
    .brand img{height:64px}
    .brand .logo{font-size:2.2rem;}

    /* Card shell */
    .card{
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:14px;
      padding:1rem;
      box-shadow:0 12px 30px rgba(0,0,0,.25);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      flex-shrink:0;
      max-height:calc(100vh - 150px);
      overflow:auto;
    }
    .section{margin-top:12px}

    h1,h2,h3{line-height:1.2}
    .muted{color:var(--muted)}
    .left-text{text-align:left}
    .center-text{text-align:center}

    /* Buttons */
    button{font-family:inherit}
    .btn{
      background:#34363d;
      color:var(--fg);
      padding:.8rem 1.4rem;
      font-size:1rem;
      border:1px solid #474a53;
      border-radius:10px;
      cursor:pointer;
      transition:background .2s,transform .08s;
    }
    .btn:hover{
      background:#3b3e46;
      transform:translateY(-1px);
    }
    .btn.small{
      padding:.6rem 1rem;
      font-size:.95rem;
    }
    .btn-row{
      display:flex;
      gap:.6rem;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:.8rem;
    }

    /* Issue choice buttons on Home */
    .issue-grid{
      margin-top:.9rem;
      display:flex;
      flex-wrap:wrap;
      gap:.75rem;
      justify-content:center;
      width:100%;
      max-width:780px;
    }
    .issue-card{
      background:#34363d;
      border:1px solid #474a53;
      border-radius:12px;
      padding:.8rem .95rem;
      min-width:220px;
      max-width:260px;
      text-align:left;
      cursor:pointer;
      box-shadow:0 4px 12px rgba(0,0,0,.35);
      transition:background .18s, transform .08s, box-shadow .18s;
      font-size:.95rem;
      line-height:1.35;
    }
    .issue-card:hover{
      background:#3b3e46;
      transform:translateY(-1px);
      box-shadow:0 6px 16px rgba(0,0,0,.4);
    }
    .issue-card-title{
      font-weight:600;
      margin-bottom:.15rem;
      color:#fff;
    }
    .issue-card-date{
      font-size:.8rem;
      color:#bfc4cf;
      margin-bottom:.25rem;
    }
    .issue-card-desc{
      font-size:.9rem;
      color:#e3e6ee;
    }

    /* Floating Sources button (Final only) */
    .side-fab{
      position:fixed;
      right:18px;
      bottom:18px;
      width:52px;
      height:52px;
      border-radius:50%;
      background:#34363d;
      color:var(--fg);
      border:1px solid #474a53;
      box-shadow:0 6px 16px rgba(0,0,0,.35);
      cursor:pointer;
      font-size:22px;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:40;
    }
    .side-fab:hover{background:#3b3e46}

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .modal-card{
      background:var(--card);
      color:var(--fg);
      border:1px solid var(--card-border);
      border-radius:14px;
      width:min(96%, 720px);
      padding:1rem;
      box-shadow:0 12px 30px rgba(0,0,0,.35);
    }
    .modal-card h3{
      font-size:1.2rem;
      margin-bottom:.4rem;
    }
    .modal-card .close-x{
      float:right;
      background:transparent;
      border:1px solid #4a4f58;
      color:#cfd6df;
      border-radius:6px;
      padding:.25rem .45rem;
      cursor:pointer;
    }
    .modal-card .close-x:hover{background:#3b3e46}
    .links-list a,
    .src-row a{
      color:var(--link-modal);
      text-decoration:underline;
    }
    .src-row{
      margin:.35rem 0;
    }
    .src-row small{
      color:#cfd6df;
    }

    /* ===== HOME ===== */
    .home-title{
      font-size:1.35rem;
      margin:8px 0 6px;
    }
    ol.instructions{
      margin:.6rem auto 0;
      max-width:680px;
      text-align:left;
      color:#e9eef7;
      line-height:1.45;
      padding-left:1.1rem;
      font-size:1rem;
    }
    ol.instructions li{
      margin:.3rem 0;
    }

    /* ===== SUMMARY LAYOUT (Part 1) ===== */
    #summary.card{
      flex-direction:row;
      align-items:flex-start;
      justify-content:space-between;
      text-align:left;
      padding:1rem 1.25rem;
      gap:1rem;
      max-height:calc(100vh - 150px);
      overflow:hidden;
    }

    .summary-left{
      flex:1;
      min-width:0;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      align-items:flex-start;
      max-height:100%;
      overflow:auto;
    }

    .summary-header-row{
      display:flex;
      align-items:center;
      gap:.5rem;
      flex-shrink:0;
      margin-bottom:.5rem;
    }
    .summary-header-row img{
      height:32px;
    }
    .summary-header-row h2{
      font-size:1.2rem;
      line-height:1.2;
      margin:0;
      color:#fff;
      font-weight:600;
    }

    .summary-title{
      font-size:1.2rem;
      color:#e9eef7;
      margin:0 0 .5rem 0;
      font-weight:600;
      max-width:100%;
      line-height:1.3;
    }

    .summary-bullets{
      line-height:1.5;
      font-size:1rem;
      color:#f2f2f2;
      max-width:100%;
      overflow:hidden;
    }
    .summary-bullets li{
      margin:.4rem 0;
    }

    .summary-cta{
      margin-top:.8rem;
      flex-shrink:0;
    }

    .summary-divider{
      width:1px;
      background:#4a4f58;
      align-self:stretch;
      flex-shrink:0;
    }

    .summary-right{
      flex-shrink:0;
      width:360px;
      max-width:360px;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:left;
      gap:.6rem;
      max-height:100%;
      overflow:hidden;
    }

    .top-image-wrap{
      width:100%;
      max-width:360px;
      border-radius:10px;
      overflow:hidden;
      border:1px solid #4a4f58;
      box-shadow:0 8px 20px rgba(0,0,0,.4);
      background:#1f2024;
      display:flex;
      align-items:center;
      justify-content:center;
      max-height:220px;
      flex-shrink:0;
    }
    .top-image-wrap img{
      display:block;
      width:100%;
      height:100%;
      object-fit:cover;
    }

    details.image-credit{
      width:100%;
      max-width:360px;
      background:#2f323a;
      border:1px solid #4a4f58;
      border-radius:8px;
      padding:.5rem .6rem;
      color:var(--muted);
      text-align:left;
      font-size:.8rem;
      line-height:1.4;
      box-shadow:0 6px 16px rgba(0,0,0,.35);
      max-height:120px;
      overflow:auto;
      flex-shrink:0;
    }
    details.image-credit summary{
      cursor:pointer;
      color:#e9eef7;
      font-weight:600;
      outline:none;
      list-style:none;
      font-size:.8rem;
    }
    details.image-credit summary::-webkit-details-marker{display:none}
    .credit-desc{
      margin-bottom:.4rem;
      font-size:.75rem;
      line-height:1.4;
      color:#d5d5d5;
    }
    .credit-url{
      font-size:.7rem;
      color:#d5d5d5;
      line-height:1.4;
      word-break:break-all;
    }
    .credit-url code{
      color:#cfe2ff;
      font-size:.7rem;
    }

    /* ===== BIAS BUSTER ===== */
    .progress-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.75rem;
      margin-bottom:.5rem;
      width:100%;
      max-width:760px;
      text-align:left;
    }
    .topic-label{
      font-size:1rem;
      color:var(--muted);
      text-align:left;
    }
    .progress-bar-wrap{
      flex:1;
      height:8px;
      background:#3a3d46;
      border-radius:5px;
      overflow:hidden;
    }
    #progress-bar{
      height:100%;
      width:0%;
      background:var(--accent);
      transition:width .25s ease;
    }
    .meta-row{
      display:flex;
      align-items:center;
      justify-content:flex-end;
      margin:.4rem 0 .7rem;
      color:var(--muted);
      width:100%;
      max-width:760px;
    }
    #progress{
      font-weight:600;
    }

    #answer-history{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:.5rem;
      margin-bottom:.8rem;
      width:100%;
      max-width:760px;
      text-align:left;
      flex-shrink:0;
    }

    .box{
      min-height:64px;
      background:var(--tile);
      border:1px solid var(--tile-border);
      border-radius:12px;
      display:flex;
      flex-direction:column;
      gap:.5rem;
      align-items:flex-start;
      justify-content:flex-start;
      box-shadow:0 2px 0 #cfcfcf;
      padding:.6rem .7rem .7rem .7rem;
      color:#202020;
      text-align:left;
      font-size:1rem;
      line-height:1.4;
    }
    .box.correct{
      border-color:#28a745;
      background:var(--green-bg);
      color:#155724;
    }
    .box.incorrect{
      border-color:#dc3545;
      background:var(--red-bg);
      color:#721c24;
    }

    .box-img-wrap{
      width:100%;
      border-radius:8px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.15);
      background:#fff;
    }
    .box-img-wrap img{
      display:block;
      width:100%;
      height:auto;
      object-fit:cover;
    }

    .box .src{
      font-size:.9rem;
      opacity:.85;
      line-height:1.4;
    }
    .box .src a{
      color:var(--link-bias);
      text-decoration:underline;
    }

    #headline-image-wrap{
      width:220px;
      max-width:220px;
      border-radius:10px;
      overflow:hidden;
      border:1px solid #4a4f58;
      box-shadow:0 8px 20px rgba(0,0,0,.4);
      background:#1f2024;
      display:flex;
      align-items:center;
      justify-content:center;
      max-height:140px;
      flex-shrink:0;
      margin-bottom:1rem;
    }
    #headline-image{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    #headline{
      background:var(--tile);
      color:#111;
      padding:1.1rem 1rem;
      border-radius:14px;
      border:1px solid var(--tile-border);
      box-shadow:0 2px 0 #cfcfcf;
      margin:.2rem 0 1rem;
      min-height:3.8rem;
      font-size:1.2rem;
      line-height:1.35;
      text-align:center;
      width:100%;
      max-width:760px;
      flex-shrink:0;
    }

    .options{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:.6rem;
      margin:.2rem 0 0;
      width:100%;
      max-width:760px;
      flex-shrink:0;
    }
    .option-btn{
      background:var(--tile);
      color:#111;
      padding:.9rem .8rem;
      border-radius:12px;
      border:1px solid var(--tile-border);
      cursor:pointer;
      transition:transform .06s ease,background .15s ease;
      box-shadow:0 2px 0 #cfcfcf;
      font-weight:600;
      text-align:center;
      font-size:1rem;
    }
    .option-btn:hover{
      background:#ededed;
      transform:translateY(-1px);
    }

    /* Timeline */
    .tl-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.75rem;
      flex-wrap:wrap;
      width:100%;
      max-width:760px;
      text-align:left;
    }
    .lives{
      color:#ffb3b3;
      font-weight:600;
      font-size:1rem;
    }
    .event-list{
      display:flex;
      flex-direction:column;
      gap:.6rem;
      list-style:none;
      margin:.8rem 0 0;
      width:100%;
      max-width:760px;
      text-align:left;
      flex-shrink:0;
    }
    .event{
      background:#34363d;
      border:1px solid #4a4f58;
      border-radius:12px;
      width:100%;
      min-height:70px;
      cursor:grab;
      user-select:none;
      display:flex;
      align-items:flex-start;
      justify-content:flex-start;
      padding:.7rem .8rem;
      text-align:left;
      color:#e9eef7;
      line-height:1.35;
      white-space:normal;
      word-break:break-word;
      transition:transform .12s ease,box-shadow .12s ease,background .12s ease;
      font-size:1rem;
    }
    .event:hover{transform:translateY(-2px)}
    .event.dragging{opacity:.8}
    .event.correct{
      border-color:#28a745;
      box-shadow:0 0 0 2px rgba(40,167,69,.25) inset;
    }
    .event.incorrect{
      border-color:#dc3545;
      box-shadow:0 0 0 2px rgba(220,53,69,.25) inset;
    }

    .tl-actions{
      display:flex;
      gap:.6rem;
      flex-wrap:wrap;
      justify-content:center;
      margin-top:.8rem;
      width:100%;
      max-width:760px;
      flex-shrink:0;
    }
    .score{
      margin-top:.4rem;
      color:var(--muted);
      text-align:center;
      width:100%;
      max-width:760px;
      font-size:1rem;
      flex-shrink:0;
    }

    .final-big{
      font-size:1.3rem;
      margin-bottom:.25rem;
      text-align:center;
    }
    .final-sub{
      color:#e9eef7;
      margin:.25rem 0 .6rem;
      text-align:center;
      font-size:1rem;
      line-height:1.4;
    }

    /* Mobile fallback */
    @media(max-width:700px){
      body{overflow:auto;}
      .card{max-height:none;overflow:auto;}
      #summary.card{
        flex-direction:column;
        align-items:flex-start;
        justify-content:flex-start;
        max-height:none;
        overflow:auto;
      }
      .summary-divider{display:none;}
      .summary-right{
        width:100%;
        max-width:360px;
      }
      .top-image-wrap{
        max-width:360px;
        max-height:none;
      }
      details.image-credit{
        max-width:360px;
      }
    }
  </style>
</head>
<body>
  <div class="center">
    <main class="screen" aria-live="polite">

      <!-- Brand -->
      <div class="brand">
        <img src="nextelect-logo.png" alt="NextElect Logo"/>
        <h1 class="logo">NextElect ‚Äî Issue of the Week</h1>
      </div>

      <!-- HOME: choose one of three issues -->
      <section id="home" class="card center-text">
        <h2 class="home-title">Welcome to NextElect</h2>
        <p class="muted">Your weekly, unbiased practice on news reading.</p>
        <ol class="instructions">
          <li>Read a short, neutral overview of this week‚Äôs issue.</li>
          <li>Play Bias Buster: identify the framing (Left, Center, Right) for 3 headlines.</li>
          <li>Put 5 key events in correct order. You have 3 lives.</li>
        </ol>

        <p class="muted" style="margin-top:.9rem;">Pick an issue to play:</p>
        <div class="issue-grid">
          <button class="issue-card" data-issue="issue1">
            <div class="issue-card-title">Issue 1: Ballroom Construction</div>
            <div class="issue-card-date">10/16/2025</div>
            <div class="issue-card-desc">Trump‚Äôs planned White House ballroom and the demolition fight around it.</div>
          </button>
          <button class="issue-card" data-issue="issue2">
            <div class="issue-card-title">Issue 2: Agencies & Executive Power</div>
            <div class="issue-card-date">10/09/2025</div>
            <div class="issue-card-desc">Court battles over how much power presidents should have over federal agencies.</div>
          </button>
          <button class="issue-card" data-issue="issue3">
            <div class="issue-card-title">Issue 3: Speech & Leaks</div>
            <div class="issue-card-date">10/02/2025</div>
            <div class="issue-card-desc">Internal fights over speech, leaks, and who controls information from inside government.</div>
          </button>
        </div>
      </section>

      <!-- SUMMARY -->
      <section id="summary" class="card section hidden">
        <div class="summary-left">
          <div class="summary-header-row">
            <img src="nextelect-logo.png" alt="NextElect Logo"/>
            <h2>Part 1 ¬∑ Summary</h2>
          </div>

          <div id="issue-title" class="summary-title"></div>

          <ul id="issue-summary" class="summary-bullets"></ul>

          <div class="summary-cta">
            <button id="to-bias" class="btn">Start Playing</button>
          </div>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-right">
          <div class="top-image-wrap" id="issue-image-wrap">
            <img id="issue-image" src="" alt="Issue image preview"/>
          </div>

          <details id="issue-image-credit" class="image-credit hidden">
            <summary>Image credit / source</summary>
            <div>
              <div id="issue-image-credit-desc" class="credit-desc"></div>
              <div class="credit-url">
                URL: <code id="issue-image-credit-url"></code>
              </div>
            </div>
          </details>
        </div>
      </section>

      <!-- BIAS BUSTER -->
      <section id="bias" class="card section hidden">
        <div id="headline-image-wrap" class="hidden">
          <img id="headline-image" src="" alt="Headline image preview"/>
        </div>

        <div class="progress-top">
          <div id="topic-label" class="topic-label">Part 2 ¬∑ Bias Buster</div>
          <div class="progress-bar-wrap"><div id="progress-bar"></div></div>
        </div>

        <div class="meta-row">
          <div id="progress">0 / 3</div>
        </div>

        <div id="answer-history"></div>

        <div id="headline"></div>

        <div class="options">
          <button class="option-btn" data-choice="left">Left</button>
          <button class="option-btn" data-choice="center">Center</button>
          <button class="option-btn" data-choice="right">Right</button>
        </div>
      </section>

      <!-- TIMELINE -->
      <section id="timeline" class="card section hidden">
        <div class="tl-head">
          <h2>Part 3 ¬∑ Timeline (earliest ‚Üí latest)</h2>
          <div class="lives" id="lives"></div>
        </div>

        <ul id="event-list" class="event-list"></ul>

        <div class="tl-actions">
          <button id="check-order" class="btn small">Check Order</button>
          <button id="reset-order" class="btn small">Reset</button>
          <button id="reshuffle" class="btn small">Reshuffle</button>
          <button id="reveal" class="btn small">Reveal</button>
          <button id="to-final-after-reveal" class="btn small hidden">Go to Results</button>
        </div>

        <p id="tl-score" class="score"></p>
      </section>

      <!-- FINAL -->
      <section id="final" class="card section hidden">
        <h2 class="final-big">Final Results</h2>
        <p id="final-line" class="final-sub"></p>
      </section>

    </main>
  </div>

  <!-- Floating Sources & Links button -->
  <button id="fab-sources" class="side-fab hidden" aria-label="Sources & Links">üîó</button>

  <!-- Sources & Links Modal -->
  <div id="sources-modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-card">
      <button id="sources-close" class="close-x" aria-label="Close">√ó</button>
      <h3>Sources & Links</h3>
      <p class="muted" style="margin:.25rem 0 .5rem">
        These are the articles used in Bias Buster for the issue you just played. The checkmarks show where you matched the bias label.
      </p>
      <div id="final-sources" style="margin:.4rem 0 .6rem"></div>
      <hr style="border:0;border-top:1px solid #4a4f58;margin:.6rem 0">
      <p class="muted" style="margin-bottom:.35rem;">
        Want to go deeper on bias and media literacy? These sites are good starting points:
      </p>
      <div class="links-list">
        <p><a href="https://redbluedictionary.org" target="_blank" rel="noopener">Red/Blue Dictionary ‚Äî how different groups define the same terms</a></p>
        <p><a href="https://www.allsides.com" target="_blank" rel="noopener">AllSides ‚Äî outlet bias ratings and side-by-side coverage</a></p>
        <p><a href="https://ground.news" target="_blank" rel="noopener">Ground News ‚Äî compare headlines and framing across outlets</a></p>
        <p><a href="https://mediabiasfactcheck.com" target="_blank" rel="noopener">Media Bias/Fact Check ‚Äî bias and factual-reporting scores</a></p>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       THREE ISSUES CONFIG
       ========================= */
    const ISSUES = {
      issue1: {
        dateLabel: "10/16/2025",
        issueImage: "https://d3i6fh83elv35t.cloudfront.net/static/2025/10/AP25296603874064-1024x685.jpg",
        issueImageCreditDesc: "Associated Press / White House construction photo (Oct 2025).",
        issue: {
          title: "White House Ballroom Construction Fight",
          summaryBullets: [
            "The White House said it will submit plans for President Donald Trump's $250 million White House ballroom project to a federal oversight body, even though demolition work has already begun.",
            "Trump praised the construction noise for the new ballroom, which would be a major physical change to the historic building.",
            "The Treasury Department told employees not to share photos of demolition work in the East Wing after images spread online."
          ]
        },
        biasRound: [
          {
            text: "Trump‚Äôs White House Ballroom Sparks Questions About Funding and Ethics",
            answer: "left",
            author: "FactCheck.org",
            url: "https://www.factcheck.org/2025/10/trumps-white-house-ballroom-sparks-questions-about-funding-and-ethics",
            image: "https://example.com/ethics-questions.jpg"
          },
          {
            text: "Trump celebrates White House demolition as new ballroom rises: 'Music to my Ears'",
            answer: "right",
            author: "Fox News",
            url: "https://www.foxnews.com/politics/trump-celebrates-white-house-demolition-new-ballroom-rises-music-my-ears",
            image: "https://example.com/trump-smiling.jpg"
          },
          {
            text: "Treasury Tells Employees Not to Share Photos of White House Ballroom Construction",
            answer: "center",
            author: "Wall Street Journal",
            url: "https://www.wsj.com/politics/policy/treasury-tells-employees-not-to-share-photos-of-white-house-ballroom-construction-1d4f2c49",
            image: "https://example.com/no-photos-memo.jpg"
          }
        ],
        timelineEvents: [
          { id: 1, text: "The White House Announces Ballroom Construction" },
          { id: 2, text: "Demolition and Construction begin on the ballroom" },
          { id: 3, text: "Many lawmakers, especially Democrats, denounce demolition" },
          { id: 4, text: "Treasury Dept tells employees not to photograph construction" },
          { id: 5, text: "Trump announces that the entire East Wing is to be demolished" }
        ],
        timelineLives: 3
      },

      /* You can edit Issue 2 & 3 content however you want.
         Structure is the same: dateLabel, issueImage, issue, biasRound, timelineEvents, timelineLives. */

      issue2: {
        dateLabel: "10/09/2025",
        issueImage: "https://example.com/agencies-court.jpg",
        issueImageCreditDesc: "Illustration of the U.S. Supreme Court and federal agencies.",
        issue: {
          title: "Supreme Court & Agency Power",
          summaryBullets: [
            "The Supreme Court is weighing cases that could limit how independent federal agencies can be from the president.",
            "Supporters say changes would rein in unaccountable bureaucrats; critics say it would give presidents too much direct control.",
            "The rulings could affect everything from environmental rules to financial regulation for years to come."
          ]
        },
        biasRound: [
          {
            text: "Court May Upend 90-Year Rule Limiting Presidents‚Äô Control of Agencies",
            answer: "left",
            author: "AP News",
            url: "https://example.com/court-upend-rule",
            image: "https://example.com/court-upend.jpg"
          },
          {
            text: "Justices Take Aim at ‚ÄòUnaccountable Bureaucrats‚Äô as Agency Power Case Begins",
            answer: "right",
            author: "Conservative Daily",
            url: "https://example.com/unaccountable-bureaucrats",
            image: "https://example.com/agency-gavel.jpg"
          },
          {
            text: "What the Supreme Court‚Äôs Agency Cases Could Mean for Future Presidents",
            answer: "center",
            author: "Reuters",
            url: "https://example.com/future-presidents",
            image: "https://example.com/neutral-court.jpg"
          }
        ],
        timelineEvents: [
          { id: 1, text: "A coalition of states challenges long-standing agency power precedent" },
          { id: 2, text: "Supreme Court agrees to hear agency power cases" },
          { id: 3, text: "Oral arguments focus on how much control presidents should have" },
          { id: 4, text: "Court hands down ruling narrowing agency independence" },
          { id: 5, text: "Congress debates new laws to respond to the decision" }
        ],
        timelineLives: 3
      },

      issue3: {
        dateLabel: "10/02/2025",
        issueImage: "https://example.com/leaks-press.jpg",
        issueImageCreditDesc: "Stock photo of microphones and reporters outside a government building.",
        issue: {
          title: "Speech, Leaks & Information Control",
          summaryBullets: [
            "New internal rules are drafted around how officials can speak publicly and what counts as an unauthorized leak.",
            "Free-speech advocates warn the guidelines may chill whistleblowers and public criticism.",
            "Supporters argue tighter rules are needed to protect sensitive information and maintain discipline inside agencies."
          ]
        },
        biasRound: [
          {
            text: "Administration Cracks Down on ‚ÄòDisloyal‚Äô Leakers and Critics Inside Government",
            answer: "right",
            author: "Patriot Wire",
            url: "https://example.com/disloyal-leakers",
            image: "https://example.com/leak-hunt.jpg"
          },
          {
            text: "New Gag Rules Could Silence Whistleblowers, Civil Liberties Groups Warn",
            answer: "left",
            author: "Civil Liberty News",
            url: "https://example.com/gag-rules",
            image: "https://example.com/mic-tape.jpg"
          },
          {
            text: "What the New Speech Rules Actually Say ‚Äî and What They Don‚Äôt",
            answer: "center",
            author: "Nonpartisan Policy Review",
            url: "https://example.com/speech-rules-text",
            image: "https://example.com/paper-rules.jpg"
          }
        ],
        timelineEvents: [
          { id: 1, text: "Draft internal speech and leak guidelines circulate inside agencies" },
          { id: 2, text: "Civil liberties groups publish open letter criticizing the draft" },
          { id: 3, text: "Administration releases final version of speech and leak rules" },
          { id: 4, text: "First test case: employee disciplined under new rules" },
          { id: 5, text: "Federal court hears challenge to parts of the policy" }
        ],
        timelineLives: 3
      }
    };

    /* Current issue state */
    let CURRENT = null;

    /* Helpers */
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const esc = (s) => (s||"").replace(/[&<>"']/g, m => (
      {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]
    ));
    const cap = (s) => s ? s[0].toUpperCase() + s.slice(1) : s;

    function showOnly(id){
      ['home','summary','bias','timeline','final'].forEach(x => $('#'+x).classList.add('hidden'));
      $('#'+id).classList.remove('hidden');
      window.scrollTo({top:0,left:0,behavior:'instant'});
    }

    /* ========= ISSUE SELECTION (HOME ‚Üí SUMMARY) ========= */
    function loadSummaryForCurrent(){
      if(!CURRENT) return;
      $('#issue-title').textContent = `${CURRENT.dateLabel} ¬∑ ${CURRENT.issue.title}`;

      const list = $('#issue-summary');
      list.innerHTML = '';
      CURRENT.issue.summaryBullets.forEach(b => {
        const li = document.createElement('li');
        li.textContent = b;
        list.appendChild(li);
      });

      if (CURRENT.issueImage && CURRENT.issueImage.trim() !== "") {
        $('#issue-image').src = CURRENT.issueImage;
        $('#issue-image').alt = CURRENT.issue.title || "Issue image";
        $('#issue-image-wrap').classList.remove('hidden');

        $('#issue-image-credit-desc').textContent = CURRENT.issueImageCreditDesc || "";
        $('#issue-image-credit-url').textContent = CURRENT.issueImage;
        $('#issue-image-credit').classList.remove('hidden');
      } else {
        $('#issue-image-wrap').classList.add('hidden');
        $('#issue-image-credit').classList.add('hidden');
      }
    }

    $$('.issue-card').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.dataset.issue;
        CURRENT = ISSUES[key];
        loadSummaryForCurrent();
        showOnly('summary');
      });
    });

    /* ========= SUMMARY ‚Üí BIAS ========= */
    $('#to-bias').addEventListener('click', () => {
      initBias();
      showOnly('bias');
    });

    /* ========= BIAS BUSTER ========= */
    const TOTAL = 3;
    let bbIndex = 0;
    let bbAnswered = 0;
    let bbScore = 0;

    function initBias(){
      if(!CURRENT) return;
      bbIndex = 0;
      bbAnswered = 0;
      bbScore = 0;

      $('#topic-label').textContent = "Part 2 ¬∑ Bias Buster";
      $('#progress-bar').style.width = '0%';
      $('#progress').textContent = `0 / ${TOTAL}`;
      $('#answer-history').innerHTML = '';
      $('#headline-image-wrap').classList.add('hidden');

      showBBQuestion();
    }

    function showBBQuestion(){
      const q = CURRENT.biasRound[bbIndex];

      $('#headline').textContent = q.text;

      if (q.image && q.image.trim() !== "") {
        $('#headline-image').src = q.image;
        $('#headline-image').alt = q.text;
        $('#headline-image-wrap').classList.remove('hidden');
      } else {
        $('#headline-image-wrap').classList.add('hidden');
      }

      $$('.option-btn').forEach(b => b.disabled = false);
    }

    function appendHistory(correct, item){
      const box = document.createElement('div');
      box.className = 'box ' + (correct ? 'correct' : 'incorrect');
      const status = correct ? '‚úÖ Correct' : '‚ùå Correct bias';

      const imgHTML = (item.image && item.image.trim() !== "")
        ? `<div class="box-img-wrap"><img src="${esc(item.image)}" alt="${esc(item.text)}"></div>`
        : '';

      box.innerHTML = `
        ${imgHTML}
        <div><strong>${status}:</strong> ${cap(item.answer)}</div>
        <div class="src">
          Source: ${esc(item.author||'')}
          ${item.url ? ` ‚Ä¢ <a href="${esc(item.url)}" target="_blank" rel="noopener">Open</a>` : ''}
        </div>
      `;
      $('#answer-history').appendChild(box);
    }

    function handleBias(choice){
      const q = CURRENT.biasRound[bbIndex];

      $$('.option-btn').forEach(b => b.disabled = true);

      const correct = (choice === q.answer);
      if(correct) bbScore++;

      appendHistory(correct, q);

      bbAnswered++;
      $('#progress').textContent = `${bbAnswered} / ${TOTAL}`;
      $('#progress-bar').style.width = `${(bbAnswered/TOTAL)*100}%`;

      setTimeout(() => {
        bbIndex++;
        if (bbIndex < TOTAL){
          showBBQuestion();
        } else {
          initTimeline();
          showOnly('timeline');
        }
      }, 450);
    }

    $$('.option-btn').forEach(btn => {
      btn.addEventListener('click', () => handleBias(btn.dataset.choice));
    });

    /* ========= TIMELINE ========= */
    let lives = 0;
    let startLayout = [];

    function hearts(n){
      return '‚ù§Ô∏è'.repeat(Math.max(0,n));
    }
    function updateLives(){
      $('#lives').innerHTML = `Lives: ${lives} ${hearts(lives)}`;
    }

    function initTimeline(){
      if(!CURRENT) return;
      lives = CURRENT.timelineLives;
      updateLives();
      buildTimeline(shuffle([...CURRENT.timelineEvents]));
      $('#tl-score').textContent = '';
      $('#to-final-after-reveal').classList.add('hidden');
    }

    function shuffle(arr){
      for(let i=arr.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr;
    }

    function buildTimeline(items){
      const list = $('#event-list');
      list.innerHTML = '';
      items.forEach(ev => {
        const li = document.createElement('li');
        li.className = 'event';
        li.draggable = true;
        li.dataset.id = ev.id;
        li.innerHTML = `
          <div style="display:flex;gap:.55rem;align-items:flex-start">
            <div style="opacity:.7">‚ò∞</div>
            <div class="event-text">${esc(ev.text)}</div>
          </div>
        `;
        list.appendChild(li);
      });
      startLayout = currentIds();
      wireDnDVertical();
    }

    function currentIds(){
      return $$('#event-list .event').map(n => parseInt(n.dataset.id,10));
    }
    function correctIds(){
      return [...CURRENT.timelineEvents]
        .sort((a,b)=>a.id - b.id)
        .map(e => e.id);
    }

    function scoreTimeline({reveal=false} = {}){
      const order = currentIds();
      const correct = correctIds();

      let hits = 0;
      $$('#event-list .event').forEach((n,i) => {
        const ok = order[i] === correct[i];
        if(ok) hits++;
        n.classList.toggle('correct', ok);
        n.classList.toggle('incorrect', !ok && !reveal);
      });

      const total = correct.length;
      const pct = Math.round((hits/total)*100);

      $('#tl-score').textContent = reveal
        ? `Correct order shown. (Last attempt: ${hits}/${total})`
        : `You placed ${hits} of ${total} correctly (${pct}%). Lives left: ${lives}`;

      return hits === total;
    }

    function wireDnDVertical(){
      const list = $('#event-list');
      let dragging = null;

      $$('#event-list .event').forEach(el => {
        el.addEventListener('dragstart', e => {
          dragging = el;
          el.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'move';
          e.dataTransfer.setData('text/plain', el.dataset.id);

          $$('#event-list .event').forEach(n => n.classList.remove('correct','incorrect'));
        });

        el.addEventListener('dragend', () => {
          if(dragging){
            dragging.classList.remove('dragging');
            dragging = null;
          }
        });
      });

      list.addEventListener('dragover', e => {
        e.preventDefault();
        if(!dragging) return;

        const after = closestVertical(list, e.clientY, dragging);
        if(after == null){
          list.appendChild(dragging);
        } else {
          list.insertBefore(dragging, after);
        }
      });

      list.addEventListener('drop', e => e.preventDefault());
    }

    function closestVertical(container, y, ignore){
      const els = [...container.querySelectorAll('.event')].filter(n => n !== ignore);
      if(els.length === 0) return null;

      let best = {el:null, d:Infinity};
      for(const el of els){
        const r = el.getBoundingClientRect();
        const cy = r.top + r.height/2;
        const d = Math.abs(y - cy);
        if(d < best.d){
          best = {el, d};
        }
      }
      if(!best.el) return null;

      const r = best.el.getBoundingClientRect();
      const after = y > (r.top + r.height/2);
      return after ? best.el.nextSibling : best.el;
    }

    // Check order
    $('#check-order').addEventListener('click', () => {
      const win = scoreTimeline({reveal:false});
      if(win){
        goFinal();
        return;
      }

      lives--;
      updateLives();

      if(lives <= 0){
        $('#tl-score').textContent = "Out of lives. Showing correct order, then taking you to results‚Ä¶";
        revealOrder(true);
        setTimeout(() => goFinal(), 900);
      } else {
        $('#tl-score').textContent += " ¬∑ Try again.";
      }
    });

    function revealOrder(fromLoss=false){
      const ordered = [...CURRENT.timelineEvents].sort((a,b)=>a.id - b.id);
      buildTimeline(ordered);
      scoreTimeline({reveal:true});

      if(!fromLoss){
        $('#to-final-after-reveal').classList.remove('hidden');
        $('#tl-score').textContent = "Here's the correct order. Ready to see your results?";
      }
    }

    $('#reveal').addEventListener('click', () => revealOrder(false));
    $('#to-final-after-reveal').addEventListener('click', () => goFinal());

    $('#reshuffle').addEventListener('click', () => {
      buildTimeline(shuffle([...CURRENT.timelineEvents]));
      $('#tl-score').textContent = '';
      $('#to-final-after-reveal').classList.add('hidden');
    });

    $('#reset-order').addEventListener('click', () => {
      const byId = Object.fromEntries(CURRENT.timelineEvents.map(e => [e.id, e]));
      const items = startLayout.map(id => byId[id]);
      buildTimeline(items);
      $('#tl-score').textContent = '';
      $('#to-final-after-reveal').classList.add('hidden');
    });

    /* ========= FINAL ========= */
    function goFinal(){
      const livesLeft = Math.max(0, lives);
      const finalScore = bbScore + livesLeft;
      const biasPart = `${bbScore}/3`;
      const livesPart = `${livesLeft}/3`;

      let msg;
      if(finalScore === 6){
        msg = `üî• Outstanding! Score ${finalScore}/6 ‚Äî Perfect balance of bias spotting (${biasPart}) and timeline recall (${livesPart}).`;
      } else if(finalScore >= 5){
        msg = `üí™ Strong work! Score ${finalScore}/6 ‚Äî Bias: ${biasPart}. Lives: ${livesPart}. So close to perfect.`;
      } else if(finalScore >= 3){
        msg = `üëç Solid start. Score ${finalScore}/6 ‚Äî Bias: ${biasPart}. Lives: ${livesPart}. A couple tweaks and you‚Äôll nail it.`;
      } else {
        msg = `üîÅ Keep going. Score ${finalScore}/6 ‚Äî Bias: ${biasPart}. Lives: ${livesPart}. Recheck the summary and try again.`;
      }
      $('#final-line').textContent = msg;

      // Fill modal content with current issue's sources
      const fs = $('#final-sources');
      fs.innerHTML = '';
      CURRENT.biasRound.forEach((item, i) => {
        const hist = $$('#answer-history .box')[i];
        const gotIt = hist ? hist.classList.contains('correct') : false;
        const row = document.createElement('div');
        row.className = 'src-row';
        row.innerHTML = `${gotIt ? '‚úÖ' : '‚ùå'} ${esc(item.text)}<br>
          <small>Bias: ${cap(item.answer)} ¬∑ Source: ${esc(item.author||'')}${
            item.url ? ` ¬∑ <a href="${esc(item.url)}" target="_blank" rel="noopener">Open</a>` : ''
          }</small>`;
        fs.appendChild(row);
      });

      showOnly('final');
      $('#fab-sources').classList.remove('hidden');
    }

    // Floating Sources button / modal
    const fab = $('#fab-sources');
    const modal = $('#sources-modal');
    const closeBtn = $('#sources-close');

    fab.addEventListener('click', () => modal.classList.remove('hidden'));
    closeBtn.addEventListener('click', () => modal.classList.add('hidden'));
    modal.addEventListener('click', (e) => {
      if(e.target === modal) modal.classList.add('hidden');
    });
  </script>
</body>
</html>
